package main

import (
	"bytes"
	"os"
	"os/exec"
	"testing"

	. "github.com/gregoryv/web"
)

func Test_generate_readme(t *testing.T) {
	out, err := exec.Command("go", "run", ".", "-h").CombinedOutput()
	if err != nil {
		t.Fatal(err)
	}
	// replace temporary build name
	from := bytes.Index(out, []byte("/tmp/"))
	to := bytes.Index(out, []byte("/cv"))
	res := append(out[:from], out[to+1:]...)

	data, err := os.ReadFile("example.yaml")
	if err != nil {
		t.Fatal(err)
	}

	company, err := os.ReadFile("preferit.yaml")
	if err != nil {
		t.Fatal(err)
	}

	page := NewPage(
		Html(
			Body(
				"<!-- Generated by main_test.go, DO NOT EDIT! -->",

				P(`cv - command for generating HTML from YAML`),
				Br(),

				`<img src="overview.svg" style="width: 500px"/>`,

				Br(),

				Pre("$ cv -h\n", string(res)),

				H2("File formats"),

				P(`Two files are used to produce the final HTML, the
				curriculum vitae of a person and optional company
				profile. Both files are in yaml format.`),

				H3("Curriculum Vitae yaml"),

				Pre(string(data)),

				H3("Company yaml"),

				Pre(string(company)),
			),
		),
	)
	page.SaveAs("README.md")
}
